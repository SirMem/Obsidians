---
Project: "[[8086汇编]]"
Status: 
tags:
  - Resources
Deadline: 
CreateTime: 
Connected:
  - "[[8086寄存器]]"
sticker: emoji//263a-fe0f
---
# 概念

数据传送是计算机中最基本、最重要的一类操作。在程序中，数据传送指令使用的比例最高，它们用于实现存储器与寄存器、寄存器与寄存器、累加器（AL/AX）与 I/O 端口之间的字节或字的传送，也可将立即数传送到寄存器或存储器单元中。为此，指令中必须指明操作数的源位置和目标位置。

这类指令共有 14 条，分为 4 组，如表 3-4 所示。其中，除了 SAHF 和 POPF 指令以外，其余指令执行后对标志位都没有影响。
![[Pasted image 20240407111625.png]]
# 通用数据传送指令
通用数据传送指令共 5 条，它们（除 XCHG 外）是唯一允许以段寄存器作为操作数的指令。
## MOV
指令格式：MOV OPRD1，OPRD2

功能：将源操作数传送给目标操作数，即 OPRD2→OPRD1，源操作数保持不变。OPRD1 和 OPRD2 可以是字节或字，但两者必须等长（同为字节传送或字传送）。

MOV 指令有如下一些形式：

MOV reg/Sreg/mem，reg  ；reg/Sreg/mem←reg
MOV reg/mem，Sreg      ；reg/mem←Sreg
MOV reg/Sreg，mem      ；reg/Sreg←mem
MOV reg/mem，imm       ；reg/mem←imm

源操作数可以是通用寄存器、段寄存器、存储器以及立即操作数；目标操作数可以是通用寄存器、段寄存器（CS 除外）或存储器。各种数据传送关系如图 3-4 所示。

![[Pasted image 20240407111735.png]]

例如：

MOV AL，CH          ；通用寄存器之间传送字节数据 
MOV DS，AX          ；通用寄存器与段寄存器（CS 不能是目标）之间传送数据 
MOV AX，0FF3BH      ；立即数 FF3BH 传送到通用寄存器 
MOV AL，BUFFER      ；存储器与通用寄存器之间传送数据，BUFFER 为字节存储单元名 
MOV DAT[BP+DI]，ES  ；段寄存器与存储器之间传送数据，DAT 为常量或字存储单元名(`DAT[BP+DI]`表示的是以`DAT`为基址，`BP+DI`为偏移量的内存地址。这种寻址方式被称为**基址变址寻址**。)

使用 MOV 指令传送数据时应该注意：① 立即数和段寄存器 CS 不能作为目标操作数；② 立即数不能直接传送到段寄存器；③ 不允许在两个存储单元之间或在两个段寄存器之间直接传送数据；④ 将立即数传送到存储单元时，必须显式说明存储器操作数的宽度类型。

## 堆栈操作PUSH/POP
堆栈是内存的一个数据区，是按照「先进后出」原则组织的一段内存区域。

80x86/Pentium CPU 规定，堆栈设置在堆栈段（SS）内，向下生长，堆栈指针 SP 始终指向堆栈的顶部。在子程序（过程）调用或处理中断时，堆栈用于保存当前的断点地址（在 8086/8088 中为 CS 和 IP）和现场数据，以便程序正确返回。断点地址的保存是由子程序调用指令或中断响应来完成的，现场数据保存可通过堆栈操作指令来实现。(中断)


### 指令格式
指令格式：PUSH OPRD2 ；POP OPRD1

功能：PUSH 指令使 SP-2→SP，然后将 16 位源操作数压入堆栈。入栈时，高字节存放在高地址，低字节存放在低地址。源操作数可以是通用寄存器、段寄存器和存储器。

出栈指令 POP 的执行过程与 PUSH 相反。它从栈顶弹出 16 位操作数到目标操作数。弹出时，低地址字节送低字节，高地址字节送高字节，同时修改 SP+2→SP，使 SP 指向新的栈顶。目标操作数可以是通用寄存器、段寄存器（CS 除外）或存储器

![[uonZPfPwXUZtRIjc-17eb8243-96ba-be64-89bc-b0bf1fb237ea.png|609]]

对 8086/8088 来说，堆栈操作总是按字（而不是字节）存取，具体的入/出栈指令如下：

PUSH reg16(段寄存器)；SP=SP-2，[SP]←reg16 POP reg16；reg16←[SP]，SP=SP+2
PUSH Sreg(16位的通用寄存器)；SP=SP-2，[SP] ←Sreg POP Sreg；Sreg←[SP]，SP=SP+2
PUSH mem16(内存操作数)；SP=SP-2，[SP] ←mem16 POP mem16；mem16←[SP]，SP=SP+2

![[Pasted image 20240407112905.png]]

## XCHG
指令格式：XCHG OPRD1，OPRD2
功能：将长度相同（同为字节或同为字）的源操作数与目标操作数进行交换。

具体指令如下：
XCHG reg/mem，reg ；reg/mem←→reg
XCHG reg，mem     ；reg←→mem

例如：

MOV AX，2244H  ；AX＝2244H
MOV BX，3366H  ；BX＝3366H
XCHG AX，BX    ；交换后，AX＝3366H，BX＝2244H

注意：① 段寄存器和立即数不能作为操作数；② 不能在两个存储单元之间直接交换数据。

## 查表转换指令 XLAT（或称换码指令）
指令格式：XLAT 或 XLAT OPRD；AL← [BX+AL]

功能：完成 1 字节的查表转换。它将数据段中偏移地址为（BX+AL）的存储单元的内容送入 AL 寄存器，即 DS:[BX+AL]→AL。

XLAT 指令对于一些无规律的代码转换（换码）特别方便。使用时，首先在数据段建立一个长度小于 256 字节的表格，表的首地址置于 BX 中，AL 中存放查找对象在表中的下标。指令执行后，所查找的对象存于 AL 中，BX 内容保持不变。

例如：将数字 0～9 的 BCD 码转换为 7 段 LED 显示器的显示代码。

数字 0～9 的 BCD 码对应的 7 段 LED 显示代码为 40H，79H，24H，30H，19H，12H，02H，78H，00H，18H，将它们依次存放在数据段中偏移地址为 0800H 开始的区域。若待转换的 BCD 码为 0100B，则实现代码转换的程序段为：

MOV BX，0800H
MOV AL，4
XLAT          ；AL 中为 0100B 对应的 7 段代码 19H

XLAT 指令的操作数是隐含的，汇编语言程序中可指定表的首地址以方便阅读。表的首地址名称仅供汇编程序使用，对指令的执行没有任何影响。该指令还允许段超越，如 ES:XLAT。

# 地址传送指令
## 逻辑
这组指令传送存储器的逻辑地址信息，如表所示，指令中的源操作数只能是存储器操作数。
![[Pasted image 20240407194458.png]]

## 有效地址传送指令LEA
指令格式：LEA OPRD1，OPRD2
功能：将源操作数在当前段内的有效地址（即偏移地址）传送至目标操作数。

具体指令为：

LEA reg16，mem  ；reg16←Addr（mem）

注意：这条指令同 MOV 指令的区别是，MOV 指令传送操作数的内容，而 LEA 传送的是操作数的存储地址。例如：

MOV DI，TABLE    ；将变量 TABLE 的内容传送至 DI
LEA DI，TABLE    ；将变量 TABLE 的偏移地址传送至 DI
LEA DX，[1000H]  ；将 1000H 单元的偏移地址 →DX，DX=1000H

## 地址指针传送指令LDS和LES
指令格式：LDS/LES OPRD1，OPRD2

这两条指令的功能类似，都是将由源操作数偏移地址决定的双字存储单元中的第一个字的内容送入指令指定的 16 位[[8086寄存器#通用寄存器|通用寄存器]]，第二个字的内容传送给段寄存器 DS 或 ES。通常，双字存储单元中是一个 32 位的地址指针。

具体指令为：

LDS（LES） reg16，mem  ；reg16←[EA] (内存中一个有效地址)，DS（ES） ←[EA+2]

例如：

TABLE DD 12345678H
      LDS BX，TABLE    ；BX←5678H，DS←1234H

# 标志位传送指令
## 逻辑
CPU 通过这类指令对标志寄存器（FR）进行保护与更新。指令的操作数用隐含方式规定，指令共 4 条

## 标志寄存器读/写指令 LAHF/SAHF
指令 LAHF 用于将[[8086寄存器#标志寄存器|标志寄存器]]的低字节（含 SF、ZF、AF、PF、CF）读出后传送给 AH 寄存器。这条指令本身不影响标志位。

标志寄存器写指令 SAHF 与 LAHF 的操作相反。它把寄存器 AH 中的内容写入标志寄存器的低字节，取代某些标志位（SF、ZF、AF、PF、CF）的原来状态。

## 标志寄存器入栈/出栈指令 PUSHF/POPF
PUSHF 指令的执行过程同 PUSH 指令，只是将标志寄存器 FR 的内容压入堆栈。POPF 则将当前栈顶的<font color="#c0504d">一个字</font>传送给标志寄存器 FR，同时修改栈顶指针 SP。

在子程序调用和中断服务中，常用这两条指令保护和恢复需要的标志位。利用它们还可以方便地改变标志寄存器中任一位的状态。例如，8086/8088 指令系统中没有直接修改 TF 标志位的指令，可用以下程序段来实现 TF 的改变：

PUSHF
POP AX      ；标志寄存器的内容送 AX
OR AH，01H  ；将 TF 位置 1（TF 在标志寄存器的 b8位）
PUSH AX
POPF        ；AX 的内容送标志寄存器

# 输入/输出数据传送指令 IN/OUT
指令格式：IN OPRD1，OPRD2

OUT OPRD1，OPRD2

这组指令专门用于在 AL 或 AX 寄存器与 I/O [[计算机组成原理#端口|端口]]之间传送数据。

一台计算机可以配接许多外部设备，每个外部设备与 CPU 之间要交换数据、状态信息和控制命令，每一种这样的信息交换都要通过一个端口来进行。计算机系统中的各个端口也像存储器那样用地址来区分。

80x86/Pentium CPU 中有 16 条 I/O 地址线，最多可提供 64K 个传送 8 位数据的端口地址或 32K 个传送 16 位数据的端口地址。当端口地址小于 256 时，采用直接寻址方式，在指令中直接指定端口地址；当端口地址大于或等于 256 时，采用间接寻址方式，端口地址放在 DX 中。

具体指令有：

IN AL，imm8 ；AL←[端口 imm8]（其他同） OUT imm8，AL ；[imm8] ←AL
IN AX，imm8 ；AX←[imm8+1]， [imm8]     OUT imm8，AX ；[imm8+1]， [imm8] ←AX
IN AL，DX   ；AL←[DX]                 OUT DX，AL   ；[DX] ←AL
IN AX，DX   ；AX←[DX+1]， [DX]         OUT DX，AX   ；[DX+1]， [DX] ←AX

例如：

IN    AX，20H   ；从端口 20H 和 21H 输入 16 位数据到 AL 和 AH（AX）
MOV   DX，3F0H
IN    AL，DX    ；从端口 03F0H 输入 8 位数据到 AL
OUT   27H，AL   ；将 8 位数据从 AL 输出到端口 27H
OUT   DX，AX    ；将 16 位数据从 AX 输出到 DX 和 DX+1 指定的端口